sudo: required
services:
- docker
env:
  global:
  - BASEIMAGE=registry.opensuse.org/devel/openqa/containers/openqa_dev:latest
  matrix:
  - E2MODE=master
  - E2MODE=ln
  - E2MODE=mix
  - E2MODE=system2
  - E2MODE=integration
before_script:
- docker pull $BASEIMAGE
- sudo mkdir -p /etc/openqa/
- echo "[127.0.0.1]" | sudo tee -a /etc/openqa/client.conf
- echo "key = 1234567890ABCDEF" | sudo tee -a /etc/openqa/client.conf
- echo "secret = 1234567890ABCDEF" | sudo tee -a /etc/openqa/client.conf
script:
- docker run -v $(pwd):/e2 -v /etc/openqa:/etc/openqa $BASEIMAGE -c "[ $E2MODE == integration ] || (cd /e2; zypper -n in perl-TimeDate; zypper -n addrepo http://download.opensuse.org/repositories/devel:/openQA:/ci/openSUSE_Leap_15.1 qemu; zypper -n --gpg-auto-import-keys --no-gpg-checks refresh; zypper -n in --from qemu qemu qemu-x86 qemu-tools qemu-ipxe qemu-sgabios qemu-kvm qemu-seabios; useradd $(id -nu) -u $(id -u) || :; sudo -u \#$(id -u) .test/product-test.sh $E2MODE)"
- docker run -v $(pwd):/e2 -v /etc/openqa:/etc/openqa $BASEIMAGE -c "[ $E2MODE != integration ] || (cd /e2; zypper -n in perl-TimeDate; zypper -n addrepo http://download.opensuse.org/repositories/devel:/openQA:/ci/openSUSE_Leap_15.1 qemu; zypper -n --gpg-auto-import-keys --no-gpg-checks refresh; zypper -n in --from qemu qemu qemu-x86 qemu-tools qemu-ipxe qemu-sgabios qemu-kvm qemu-seabios; useradd $(id -nu) -u $(id -u) || :; sudo -u \#$(id -u) bash -x .product/qa/branch/.example/fullstack.sh)"
